---
import Card from "@ui/Card.astro";
import Badge from "@ui/Badge.astro";
import Button from "@ui/Button.astro";
import Avatar from "@ui/Avatar.astro";
import { Icon } from "astro-icon/components";

// Fonction pour extraire les initiales du nom
function getInitials(name: string): string {
  if (!name) return "??";
  return name
    .split(' ')
    .map((part: string) => part.charAt(0).toUpperCase())
    .slice(0, 2)
    .join('');
}

const initiales = getInitials(Astro.props.entry.nom);

// Détermine si le membre de l'équipe a des liens de réseaux sociaux
const hasSocialLinks = Astro.props.entry.linkedin || Astro.props.entry.instagram || Astro.props.entry.twitter || Astro.props.entry.facebook;

// Tableau des certifications (si présent)
const certifications = Astro.props.entry.certifications 
  ? Astro.props.entry.certifications.split(',').map((cert: string) => cert.trim())
  : [];
---

<Card padding="lg" variant="default" class="team-card">
  <div class="team-card-content">
    <!-- Photo/Avatar du membre avec positionnement amélioré -->
    <div class="team-card-avatar-wrapper">
      <Avatar src={Astro.props.entry.photo} alt={Astro.props.entry.nom} size="lg" class="team-card-avatar" fallback={initiales} />
      {Astro.props.entry.role && (
        <div class="team-card-role-badge">
          <Badge variant="secondary">{Astro.props.entry.role}</Badge>
        </div>
      )}
    </div>
    
    <!-- Nom et informations avec espacement amélioré -->
  <div class="team-card-info">
  <h3 class="team-card-name">{Astro.props.entry.nom}</h3>
      {Astro.props.entry.diplome && (
        <div class="team-card-diplome">
          <Icon name="mdi:school" class="team-card-diplome-icon" />
          <span class="team-card-diplome-text">{Astro.props.entry.diplome}</span>
        </div>
      )}
      {Astro.props.entry.bio && (
        <p class="team-card-bio">
          {Astro.props.entry.bio.length > 120 
            ? Astro.props.entry.bio.substring(0, 120) + '...' 
            : Astro.props.entry.bio}
        </p>
      )}
      {certifications.length > 0 && (
        <div class="team-card-certifications">
          {certifications.slice(0, 2).map((cert: string) => (
            <Badge variant="default">{cert}</Badge>
          ))}
          {certifications.length > 2 && (
            <Badge variant="default">+{certifications.length - 2}</Badge>
          )}
        </div>
      )}
            </Badge>
          )}
        </div>
      )}
      
      <!-- Contacts -->
  <div class="team-card-contacts">
        {Astro.props.entry.email && (
          <a 
            href={`mailto:${Astro.props.entry.email}`}
            class="team-card-contact-link"
          >
            <Icon name="mdi:email" class="team-card-contact-icon" />
            {Astro.props.entry.email}
          </a>
        )}
        
        {Astro.props.entry.telephone && (
          <a 
            href={`tel:${Astro.props.entry.telephone}`}
            class="team-card-contact-link"
          >
            <Icon name="mdi:phone" class="team-card-contact-icon" />
            {Astro.props.entry.telephone}
          </a>
        )}
      </div>
      
      <!-- Réseaux sociaux -->
      {hasSocialLinks && (
        <div class="team-card-socials">
          {Astro.props.entry.linkedin && (
            <a 
              href={Astro.props.entry.linkedin} 
              target="_blank" 
              rel="noopener" 
              class="team-card-social-link"
              aria-label="LinkedIn"
            >
              <Icon name="mdi:linkedin" class="team-card-social-icon" />
            </a>
          )}
          
          {Astro.props.entry.instagram && (
            <a 
              href={Astro.props.entry.instagram} 
              target="_blank" 
              rel="noopener" 
              class="text-muted-foreground dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors p-1 rounded-full hover:bg-primary/5 dark:hover:bg-primary-900/20 focus:outline-none focus:ring-2 focus:ring-primary/30 dark:focus:ring-primary-300/20"
              aria-label="Instagram"
            >
              <Icon name="mdi:instagram" class="h-5 w-5" />
            </a>
          )}
          
          {Astro.props.entry.twitter && (
            <a 
              href={Astro.props.entry.twitter} 
              target="_blank" 
              rel="noopener" 
              class="text-muted-foreground dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors p-1 rounded-full hover:bg-primary/5 dark:hover:bg-primary-900/20 focus:outline-none focus:ring-2 focus:ring-primary/30 dark:focus:ring-primary-300/20"
              aria-label="Twitter"
            >
              <Icon name="mdi:twitter" class="h-5 w-5" />
            </a>
          )}
          
          {Astro.props.entry.facebook && (
            <a 
              href={Astro.props.entry.facebook} 
              target="_blank" 
              rel="noopener" 
              class="text-muted-foreground dark:text-gray-400 hover:text-primary dark:hover:text-primary-300 transition-colors p-1 rounded-full hover:bg-primary/5 dark:hover:bg-primary-900/20 focus:outline-none focus:ring-2 focus:ring-primary/30 dark:focus:ring-primary-300/20"
              aria-label="Facebook"
            >
              <Icon name="mdi:facebook" class="h-5 w-5" />
            </a>
          )}
        </div>
      )}
      
      <!-- Bouton profil complet -->
      {Astro.props.entry.slug && (
        <div class="team-card-profile-btn-row">
          <Button 
            variant="primary" 
            size="sm"
            href={`/equipe/${Astro.props.entry.slug}`}
          >
            Voir profil complet
            <Icon name="mdi:arrow-right" class="team-card-profile-btn-icon" />
          </Button>
        </div>
      )}
<style>
  .team-card {
    background: var(--theme-card);
    color: var(--theme-card-foreground);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    padding: var(--space-8);
    transition: box-shadow 0.2s;
  }
  .team-card-content {}
  .team-card-avatar-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    margin-bottom: var(--space-4);
  }
  .team-card-avatar {
    width: 96px;
    height: 96px;
    border-radius: 50%;
    object-fit: cover;
    background: var(--theme-muted);
  }
  .team-card-role-badge {
    position: absolute;
    top: var(--space-2);
    right: var(--space-2);
    z-index: 2;
  }
  .team-card-info {
    text-align: center;
    margin-bottom: var(--space-4);
  }
  .team-card-name {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--theme-foreground);
    margin-bottom: var(--space-2);
  }
  .team-card-diplome {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    color: var(--theme-primary);
    margin-bottom: var(--space-2);
  }
  .team-card-diplome-icon {
    width: 18px;
    height: 18px;
    color: var(--theme-primary);
  }
  .team-card-diplome-text {
    font-size: 1rem;
    font-weight: 500;
  }
  .team-card-bio {
    color: var(--theme-muted-foreground);
    line-height: 1.5;
    margin-bottom: var(--space-2);
  }
  .team-card-certifications {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    justify-content: center;
    margin-bottom: var(--space-2);
  }
  .team-card-contacts {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-2);
  }
  .team-card-contact-link {
    display: inline-flex;
    align-items: center;
    font-size: 0.9rem;
    color: var(--theme-primary);
    text-decoration: underline;
    border-radius: var(--radius-sm);
    transition: color 0.2s;
  }
  .team-card-contact-icon {
    width: 16px;
    height: 16px;
    margin-right: var(--space-1);
  }
  .team-card-socials {
    display: flex;
    justify-content: center;
    gap: var(--space-3);
    margin-top: var(--space-2);
    padding-top: var(--space-2);
    border-top: 1px solid var(--theme-border);
  }
  .team-card-social-link {
    display: flex;
    align-items: center;
    color: var(--theme-muted-foreground);
    border-radius: 50%;
    padding: var(--space-1);
    transition: color 0.2s, background 0.2s;
  }
  .team-card-social-link:hover {
    color: var(--theme-primary);
    background: var(--theme-primary-50);
  }
  .team-card-social-icon {
    width: 20px;
    height: 20px;
  }
  .team-card-profile-btn-row {
    margin-top: var(--space-4);
    display: flex;
    justify-content: center;
  }
  .team-card-profile-btn-icon {
    width: 16px;
    height: 16px;
    margin-left: var(--space-2);
  }
</style>
    </div>
  </div>
</Card>